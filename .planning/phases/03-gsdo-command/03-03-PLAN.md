---
phase: 03-gsdo-command
plan: 03
type: execute
wave: 3
depends_on: [03-01, 03-02]
files_modified:
  - src/lib/installer/commands-manager.ts
  - src/cli.ts
  - src/gsdo.ts
  - src/gsdo.test.ts
autonomous: true

must_haves:
  truths:
    - "/gsdo command definition exists in transpiled commands"
    - "User can invoke /gsdo manually in OpenCode after installation"
    - "Installer automatically runs enhancement after transpilation"
    - "Enhancement runs autonomously without user input"
    - "Enhancement output shows per-command changes"
  artifacts:
    - path: "src/lib/installer/commands-manager.ts"
      provides: "/gsdo command definition creation"
      exports: ["createGsdoCommand"]
      min_lines: 150
    - path: "src/gsdo.ts"
      provides: "/gsdo CLI entry point"
      exports: []
      min_lines: 80
    - path: "src/cli.ts"
      provides: "Updated installer with auto-enhancement"
      min_lines: 150
    - path: "src/gsdo.test.ts"
      provides: "/gsdo integration test"
      min_lines: 40
  key_links:
    - from: "src/cli.ts"
      to: "src/gsdo.ts"
      via: "executes /gsdo after transpilation"
      pattern: "(spawn|exec).*gsdo"
    - from: "src/gsdo.ts"
      to: "src/lib/enhancer/engine.ts"
      via: "loadEnhancementContext call"
      pattern: "loadEnhancementContext"
    - from: "src/gsdo.ts"
      to: "src/lib/enhancer/enhancer.ts"
      via: "enhanceAllCommands call"
      pattern: "enhanceAllCommands"
---

<objective>
Install /gsdo command in OpenCode and integrate automatic enhancement into installer flow, enabling both manual re-enhancement and automatic first-run enhancement.

Purpose: Completes the two-pass architecture by making LLM enhancement accessible as a command and running it automatically after transpilation.
Output: /gsdo command installed, installer auto-runs enhancement, user can manually re-enhance later.
</objective>

<execution_context>
@C:\Users\Terence\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\Terence\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\Terence\code\gsd-open\.planning\PROJECT.md
@C:\Users\Terence\code\gsd-open\.planning\ROADMAP.md
@C:\Users\Terence\code\gsd-open\.planning\STATE.md
@C:\Users\Terence\code\gsd-open\.planning\phases\03-gsdo-command\03-gsdo-command-CONTEXT.md

# Prior plans in this phase
@C:\Users\Terence\code\gsd-open\.planning\phases\03-gsdo-command\03-01-PLAN.md
@C:\Users\Terence\code\gsd-open\.planning\phases\03-gsdo-command\03-02-PLAN.md

# Existing code
@C:\Users\Terence\code\gsd-open\src\cli.ts
@C:\Users\Terence\code\gsd-open\src\lib\installer\commands-manager.ts
@C:\Users\Terence\code\gsd-open\src\lib\enhancer\engine.ts
@C:\Users\Terence\code\gsd-open\src\lib\enhancer\enhancer.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /gsdo command definition and CLI entry point</name>
  <files>
    src/lib/installer/commands-manager.ts
    src/gsdo.ts
    src/gsdo.test.ts
  </files>
  <action>
Create /gsdo command that user can invoke in OpenCode to re-enhance commands.

**commands-manager.ts** - Add /gsdo command creation:

1. `export function createGsdoCommand(): OpenCodeCommand`
   - Return OpenCodeCommand with:
     - name: "gsdo" (or "gsd-enhance" as fallback)
     - description: "Enhance transpiled GSD commands using OpenCode's LLM (autonomous, no input required)"
     - promptTemplate: Multi-line template explaining what /gsdo does:
       ```
       You are enhancing transpiled GSD commands for OpenCode compatibility.

       This is an autonomous operation - do not request user input.

       Context available:
       - Install log: ~/.gsdo/install.log (transpilation warnings/errors)
       - OpenCode docs: ~/.gsdo/cache/docs-opencode/README.md
       - Current commands: commands.json
       - Original GSD source: ~/.claude/get-shit-done/skills/

       Enhancement scope (conservative fixes only):
       1. Fix command naming issues
       2. Fix broken references to GSD-specific files
       3. Add missing parameters
       4. Improve prompt templates for OpenCode patterns

       DO NOT remove, merge, or restructure commands.

       Process:
       1. Load context from files above
       2. For each /gsd-* command, analyze and enhance
       3. Create backup: commands.json.TIMESTAMP.backup
       4. Write enhanced commands back to commands.json
       5. Show detailed per-command report of changes

       Always exit with code 0 on success.
       ```

**gsdo.ts** - Create CLI entry point:
1. #!/usr/bin/env node shebang
2. Import loadEnhancementContext, backupCommandsJson, enhanceAllCommands, writeEnhancedCommands
3. Main flow:
   - Log "→ Loading context..."
   - Load enhancement context (handle errors if detection fails)
   - Filter to gsd-* commands only
   - Log "→ Creating backup..."
   - Create backup of commands.json
   - Log "→ Enhancing {N} commands..."
   - Call enhanceAllCommands
   - Display per-command results:
     - For each enhanced: "✓ {name}: {changes.join(', ')}"
     - For each failed: "✗ {name}: {error}"
   - Log "→ Writing enhanced commands..."
   - Write enhanced commands back
   - Log summary: "{X} enhanced, {Y} failed, {Z} unchanged"
   - Exit with code 0

**gsdo.test.ts** - Integration test:
1. Mock all filesystem operations
2. Mock LLM client
3. Test full /gsdo flow
4. Verify backup created before modification
5. Verify per-command output format

Update package.json bin to include "gsdo": "./dist/gsdo.js"
  </action>
  <verify>
npm run dev gsdo shows /gsdo CLI runs and outputs per-command results (with mocked LLM)
npm test -- gsdo.test.ts passes
  </verify>
  <done>
/gsdo command definition created, gsdo.ts CLI entry point works, test validates full flow
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate /gsdo into installer flow</name>
  <files>
    src/cli.ts
  </files>
  <action>
Update installer to automatically run /gsdo after transpilation completes.

**cli.ts** - Add auto-enhancement step:

1. After "→ Writing to OpenCode..." step completes successfully
2. Add new section:
   ```
   console.log('→ Enhancing commands with /gsdo...');
   ```
3. Import enhancement functions: loadEnhancementContext, backupCommandsJson, enhanceAllCommands, writeEnhancedCommands
4. Run enhancement inline (don't spawn separate process):
   - Load context
   - Create backup
   - Enhance all commands
   - Write enhanced commands (this updates the commands.json we just wrote)
5. Display results:
   - For each enhanced command: "  ✓ {name}: {changes.join(', ')}"
   - For errors: "  ⚠ {name}: {error}"
6. Add summary line: "  ✓ {X} commands enhanced, {Y} failed"
7. If enhancement fails completely (context loading error, etc):
   - Log "  ⚠ Enhancement unavailable: {error}"
   - Log "  → Commands installed but not enhanced"
   - Continue (don't exit with error - partial success acceptable)

Update final success message to mention /gsdo:
```
console.log('\n✓ Installation complete');
console.log(`  ${transpileResult.successful.length} GSD commands available in OpenCode`);
console.log(`  Run /gsdo in OpenCode to re-enhance commands anytime`);
```

Non-blocking enhancement: If /gsdo fails, installer still succeeds (transpiled commands are usable even if not enhanced).
  </action>
  <verify>
npm run dev completes full flow: detect → cache → scan → transpile → write → enhance
Enhancement runs automatically and shows per-command changes
Final message mentions /gsdo command availability
  </verify>
  <done>
Installer automatically runs enhancement after transpilation, displays per-command changes, completes successfully even if enhancement fails
  </done>
</task>

</tasks>

<verification>
- [ ] /gsdo command definition created with clear description and prompt template
- [ ] gsdo.ts CLI entry point implements full enhancement flow
- [ ] Installer automatically runs enhancement after transpilation
- [ ] Enhancement output shows per-command changes (✓ name: changes)
- [ ] Enhancement failures don't stop installer (non-blocking)
- [ ] Final success message mentions /gsdo availability for manual re-runs
- [ ] package.json includes gsdo binary entry point
- [ ] All tests pass (npm test)
</verification>

<success_criteria>
- User can run `npx gsd-open` and see automatic enhancement happen after transpilation
- User can run `npx gsdo` manually in their OpenCode directory to re-enhance commands
- Enhancement displays detailed per-command changes
- Backup mechanism protects against data loss
- Non-blocking enhancement allows installer to complete even if LLM unavailable
- Final message clearly communicates /gsdo availability
</success_criteria>

<output>
After completion, create `.planning/phases/03-gsdo-command/03-03-SUMMARY.md`
</output>
