---
phase: 04-enhanced-transpilation
plan: 03
type: execute
wave: 2
depends_on: [04-01, 04-02]
files_modified:
  - src/cli.ts
  - src/lib/transpiler/converter.ts
autonomous: true

must_haves:
  truths:
    - "Installer shows detailed progress during transpilation (scanning, converting, writing)"
    - "Installer displays partial success transparently (what worked, what didn't)"
    - "User sees individual command transpilation status in real-time"
  artifacts:
    - path: "src/cli.ts"
      provides: "Enhanced CLI output with verbose transpilation progress"
      contains: "console\\.log.*✓.*successful"
    - path: "src/lib/transpiler/converter.ts"
      provides: "Enhanced warning collection with details"
      contains: "warnings\\.push"
  key_links:
    - from: "src/cli.ts"
      to: "transpileResult.warnings"
      via: "displays all warnings with command names"
      pattern: "transpileResult\\.warnings"
    - from: "src/cli.ts"
      to: "transpileResult.failed"
      via: "displays failed commands with errors"
      pattern: "transpileResult\\.failed"
---

<objective>
Add verbose progress logging and partial success handling to the installer CLI.

Purpose: Requirements TRANS-06 and INSTALL-05 call for detailed progress visibility and transparent partial success reporting. Users should see what's happening during transpilation and clearly understand what worked vs. what failed.

Output: Enhanced CLI with real-time transpilation status and comprehensive error/warning display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Current CLI implementation
@src/cli.ts

# Transpiler types and converter
@src/lib/transpiler/types.ts
@src/lib/transpiler/converter.ts

# Reference: Verbose output examples
@gsdo-spec.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add verbose transpilation progress to CLI</name>
  <files>src/cli.ts</files>
  <action>
Enhance CLI output to show detailed transpilation progress matching the spec's verbose output format.

**Changes to make in cli.ts**:

1. **After scanning** (around line 75, after `console.log('Found ${gsdCommands.length} commands')`):

Add per-command transpilation progress:
```typescript
console.log('→ Transpiling commands...');

// Show per-command progress
const transpileResults = [];
for (const gsdCommand of gsdCommands) {
  const result = convertCommand(gsdCommand);
  transpileResults.push(result);

  if (result.success && result.command) {
    console.log(`  ✓ ${gsdCommand.name} → ${result.command.name}`);
    if (result.warnings && result.warnings.length > 0) {
      result.warnings.forEach(warning => {
        console.log(`    ⚠ ${warning}`);
      });
    }
  } else if (result.error) {
    console.log(`  ✗ ${gsdCommand.name}: ${result.error}`);
  }
}

// Aggregate results
const successful = transpileResults.filter(r => r.success && r.command).map(r => r.command!);
const failed = transpileResults.filter(r => !r.success).map((r, idx) => ({
  name: gsdCommands[idx].name,
  error: r.error || 'Unknown error'
}));
const warnings = transpileResults
  .filter(r => r.success && r.warnings)
  .flatMap((r, idx) =>
    r.warnings!.map(warning => ({ name: gsdCommands[idx].name, warning }))
  );

const transpileResult = { successful, failed, warnings };
```

2. **Update summary output** (around line 84):

Replace simple count with detailed breakdown:
```typescript
console.log(`  ✓ ${transpileResult.successful.length} successful`);

if (transpileResult.failed.length > 0) {
  console.log(`  ✗ ${transpileResult.failed.length} failed:`);
  transpileResult.failed.slice(0, 5).forEach((failure) => {
    console.log(`    - ${failure.name}: ${failure.error}`);
  });
  if (transpileResult.failed.length > 5) {
    console.log(`    ... and ${transpileResult.failed.length - 5} more`);
  }
}

if (transpileResult.warnings.length > 0) {
  console.log(`  ⚠ ${transpileResult.warnings.length} warnings (see above for details)`);
}
```

3. **Import convertCommand** instead of convertBatch (top of file):
```typescript
import { convertCommand } from './lib/transpiler/converter.js';
```

4. **Keep existing code** for:
   - Enhancement section (no changes)
   - Final summary (no changes)
   - Error handling (no changes)

**Expected output format** (matching spec):
```
→ Transpiling commands...
  ✓ /gsd:plan-phase → gsd-plan-phase
  ✓ /gsd:execute-phase → gsd-execute-phase
  ✓ /gsd:verify-work → gsd-verify-work
    ⚠ No description found in markdown, using generated default
  ✗ /gsd:broken-command: Invalid syntax in markdown
  ...
  ✓ 14 successful
  ✗ 1 failed:
    - /gsd:broken-command: Invalid syntax in markdown
  ⚠ 3 warnings (see above for details)
```
  </action>
  <verify>npm test shows integration tests pass, run `npm run build && node dist/cli.js` manually to verify verbose output appears</verify>
  <done>CLI shows per-command transpilation progress with ✓/✗/⚠ indicators and detailed failure/warning reporting</done>
</task>

<task type="auto">
  <name>Task 2: Enhance warning collection in converter</name>
  <files>src/lib/transpiler/converter.ts</files>
  <action>
Add more detailed warnings to help users understand transpilation issues.

**Additional warnings to add** in convertCommand function:

1. **After template extraction** (if template is empty):
```typescript
// Phase 4: Extract clean prompt template from markdown
const promptTemplate = extractPromptTemplate(gsd.rawContent);

if (!promptTemplate || promptTemplate.trim().length === 0) {
  warnings.push('Extracted template is empty - command may not work');
}
```

2. **After variable parsing** (if variables exist but description doesn't mention them):
```typescript
// Phase 4: Parse template variables
const variables = parseTemplateVariables(promptTemplate);

if (variables.length > 0 && !description.toLowerCase().includes('parameter')) {
  warnings.push(`Template uses ${variables.length} variable(s) but description doesn't mention parameters`);
}
```

3. **Keep existing warning** for missing description

**Testing**:
- Run converter tests: `npm test -- converter.test.ts`
- Warnings should appear in test output for edge cases
- Integration tests should show warnings in CLI output

**Expected warnings**:
- "No description found in markdown, using generated default"
- "Extracted template is empty - command may not work"
- "Template uses 2 variable(s) but description doesn't mention parameters"
  </action>
  <verify>npm test shows converter tests pass, warnings appear for appropriate edge cases</verify>
  <done>Converter provides detailed warnings for empty templates, missing descriptions, and undocumented variables</done>
</task>

</tasks>

<verification>
Run full test suite and manual verification:

```bash
# Run tests
npm test

# Build and run installer manually to verify verbose output
npm run build
node dist/cli.js
```

Expected results:
- All tests pass
- CLI shows per-command transpilation progress in real-time
- Failed commands displayed with error messages
- Warnings displayed with context
- Partial success clearly communicated (10/15 successful, 5 failed, etc.)

Spot check: Run installer and verify output matches spec's verbose format with ✓/✗/⚠ indicators and detailed breakdown.
</verification>

<success_criteria>
1. CLI shows per-command transpilation progress (not just summary)
2. Each command shows ✓ success, ✗ failure, or ⚠ warning indicator
3. Failed commands display with specific error messages
4. Warnings display with command context
5. Summary shows counts and details (successful/failed/warnings)
6. Partial success is transparent (12/15 successful clearly communicated)
7. All tests pass
8. Manual installer run shows verbose output matching spec
</success_criteria>

<output>
After completion, create `.planning/phases/04-enhanced-transpilation/04-03-SUMMARY.md`
</output>
