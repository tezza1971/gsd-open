---
phase: 01-core-installer
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/transpiler/scanner.ts
  - src/lib/transpiler/converter.ts
  - src/lib/transpiler/types.ts
autonomous: true

must_haves:
  truths:
    - "Installer scans GSD skills directory for /gsd:* command files"
    - "Installer converts command names from /gsd:* to /gsd-* (colon to dash)"
    - "Installer preserves GSD namespace prefix in all command names"
    - "Installer maps GSD fields to OpenCode command schema"
  artifacts:
    - path: "src/lib/transpiler/types.ts"
      provides: "Type definitions for GSD and OpenCode command schemas"
      exports: ["GsdCommand", "OpenCodeCommand", "TranspileResult"]
      min_lines: 20
    - path: "src/lib/transpiler/scanner.ts"
      provides: "Scans GSD skills directory for command files"
      exports: ["scanGsdCommands"]
      min_lines: 40
    - path: "src/lib/transpiler/converter.ts"
      provides: "Converts GSD commands to OpenCode format"
      exports: ["convertCommand", "convertBatch"]
      min_lines: 50
  key_links:
    - from: "src/lib/transpiler/scanner.ts"
      to: "fs"
      via: "reads GSD skills directory"
      pattern: "readdirSync"
    - from: "src/lib/transpiler/converter.ts"
      to: "src/lib/transpiler/types.ts"
      via: "uses command type definitions"
      pattern: "import.*GsdCommand|OpenCodeCommand"
    - from: "src/lib/transpiler/converter.ts"
      to: "algorithm"
      via: "name conversion: /gsd:* -> /gsd-*"
      pattern: "replace.*:.*-"
---

<objective>
Create algorithmic transpilation engine that scans GSD commands and converts them to OpenCode format.

Purpose: Deterministic, pattern-based conversion (no LLM) that handles basic name transformation and field mapping. Simple string replacement and structure mapping.
Output: Scanner and converter modules that produce OpenCode command objects from GSD markdown files.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@gsdo-spec.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Define transpiler type definitions</name>
  <files>src/lib/transpiler/types.ts</files>
  <action>
Create `src/lib/transpiler/types.ts` with TypeScript type definitions.

Define:
```typescript
// GSD command structure (simplified - we extract from markdown)
export interface GsdCommand {
  name: string;           // e.g., "/gsd:plan-phase"
  filePath: string;       // absolute path to .md file
  rawContent: string;     // entire markdown content
  description?: string;   // extracted from markdown (if present)
}

// OpenCode command schema (Phase 1: basic fields only)
export interface OpenCodeCommand {
  name: string;           // e.g., "gsd-plan-phase" (no slash, colon->dash)
  description: string;    // from GSD or default
  promptTemplate: string; // entire markdown content for now
}

// Transpilation result
export interface TranspileResult {
  success: boolean;
  command?: OpenCodeCommand;
  error?: string;
  warnings?: string[];
}

// Batch result
export interface TranspileBatchResult {
  successful: OpenCodeCommand[];
  failed: Array<{ name: string; error: string }>;
  warnings: Array<{ name: string; warning: string }>;
}
```

Export all interfaces. No implementation, just type definitions.
  </action>
  <verify>
Build succeeds: `npm run build`
All interfaces are exported
  </verify>
  <done>
Type definitions exist for GSD commands, OpenCode commands, and transpilation results.
  </done>
</task>

<task type="auto">
  <name>Create GSD command scanner</name>
  <files>src/lib/transpiler/scanner.ts</files>
  <action>
Create `src/lib/transpiler/scanner.ts` that reads GSD skills directory.

Implement:
- `scanGsdCommands(gsdPath: string): GsdCommand[]`
  - Constructs skills directory path: `${gsdPath}/skills/`
  - Uses `fs.readdirSync()` to list all files
  - Filters for `.md` files starting with `gsd:` (e.g., `gsd:plan-phase.md`)
  - For each file:
    - Read content with `fs.readFileSync(filePath, 'utf-8')`
    - Extract name from filename (remove `.md` extension)
    - Try to extract description from first H1 or H2 in markdown (regex: `/^##?\s+(.+)$/m`)
    - Return `GsdCommand` object with name, filePath, rawContent, description
  - Return array of all commands found

Use Node.js built-in modules: `fs`, `path`. Handle empty directories gracefully (return empty array).
  </action>
  <verify>
Build succeeds: `npm run build`
Function returns GsdCommand[] type
Imports types from `./types.ts`
  </verify>
  <done>
Scanner function exists that reads GSD skills directory and returns array of command objects with file content.
  </done>
</task>

<task type="auto">
  <name>Create command converter with basic mapping</name>
  <files>src/lib/transpiler/converter.ts</files>
  <action>
Create `src/lib/transpiler/converter.ts` with algorithmic conversion logic.

Implement:
- `convertCommand(gsd: GsdCommand): TranspileResult`
  - Convert name: Remove leading `/`, replace `:` with `-` (e.g., `/gsd:plan-phase` -> `gsd-plan-phase`)
  - Use description from GSD or default: `"Transpiled from GSD: ${gsd.name}"`
  - Use rawContent as promptTemplate (Phase 1: no template extraction, just pass through markdown)
  - Return `{ success: true, command: { name, description, promptTemplate } }`
  - On any error, return `{ success: false, error: 'Error message' }`

- `convertBatch(commands: GsdCommand[]): TranspileBatchResult`
  - Map each command through `convertCommand()`
  - Separate successful vs failed results
  - Collect warnings (e.g., if description is missing, add warning)
  - Return `{ successful: [...], failed: [...], warnings: [...] }`

Pure functions, no side effects. Use Node.js string methods only.
  </action>
  <verify>
Build succeeds: `npm run build`
Both functions exported and use correct types
Name conversion logic: `/gsd:foo` -> `gsd-foo`
  </verify>
  <done>
Converter functions exist that transform GSD commands to OpenCode format using pattern-based name conversion and field mapping.
  </done>
</task>

</tasks>

<verification>
Run `npm run build` - build succeeds with no errors
Check exports: Types, scanner, and converter functions are accessible
Verify name conversion: `/gsd:plan-phase` becomes `gsd-plan-phase`
Verify no external dependencies (only Node.js built-ins)
</verification>

<success_criteria>
Transpilation engine is complete when:
- [ ] Scanner reads all `.md` files from `~/.claude/get-shit-done/skills/` directory
- [ ] Scanner filters for files starting with `gsd:`
- [ ] Scanner extracts file content and optional description
- [ ] Converter transforms `/gsd:*` names to `gsd-*` format (colon to dash)
- [ ] Converter preserves GSD namespace prefix
- [ ] Converter maps to OpenCode command schema (name, description, promptTemplate)
- [ ] Batch converter handles multiple commands and collects errors/warnings
- [ ] All code uses Node.js built-in modules only
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-installer/01-02-SUMMARY.md`
</output>
