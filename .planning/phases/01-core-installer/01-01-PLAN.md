---
phase: 01-core-installer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/paths.ts
  - src/lib/detector.ts
autonomous: true

must_haves:
  truths:
    - "Installer automatically finds GSD at ~/.claude/get-shit-done/"
    - "Installer automatically finds OpenCode config directory"
    - "Installer exits with clear error if GSD not found"
    - "Installer exits with clear error if OpenCode not accessible"
    - "Installer works identically on Windows, macOS, and Linux"
  artifacts:
    - path: "src/lib/paths.ts"
      provides: "Cross-platform path resolution utilities"
      exports: ["resolveHome", "getGsdPath", "getOpenCodePath"]
      min_lines: 40
    - path: "src/lib/detector.ts"
      provides: "GSD and OpenCode detection with validation"
      exports: ["detectGsd", "detectOpenCode"]
      min_lines: 60
  key_links:
    - from: "src/lib/detector.ts"
      to: "src/lib/paths.ts"
      via: "imports path resolution functions"
      pattern: "import.*from.*paths"
    - from: "src/lib/detector.ts"
      to: "fs"
      via: "uses Node.js fs.existsSync to verify paths"
      pattern: "existsSync"
---

<objective>
Create cross-platform detection infrastructure that automatically finds GSD and OpenCode installations.

Purpose: Enables zero-input automation by detecting standard installation paths on all platforms using only Node.js built-in modules.
Output: Path resolution utilities and detection functions that validate GSD/OpenCode locations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@gsdo-spec.md
@package.json
@tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Create path resolution utilities</name>
  <files>src/lib/paths.ts</files>
  <action>
Create `src/lib/paths.ts` with cross-platform path resolution using Node.js built-in modules only (no external dependencies).

Implement:
- `resolveHome(pathSegment: string): string` - Expands ~ to home directory using `os.homedir()`, handles platform-specific path separators
- `getGsdPath(): string` - Returns absolute path to GSD installation: `~/.claude/get-shit-done/`
- `getOpenCodePath(): string` - Returns first existing OpenCode config directory from priority list: `.opencode/`, `~/.config/opencode/`, `%APPDATA%/opencode/` (Windows), `~/Library/Application Support/opencode/` (macOS)
- Use `path.join()` for all path construction (not string concatenation)
- Use `process.platform` to detect OS ('win32', 'darwin', 'linux')
- Export all functions individually

Do NOT use `fs` module in this file - pure path resolution only.
  </action>
  <verify>
Build succeeds: `npm run build`
No external dependencies imported (only `path`, `os` from Node.js)
  </verify>
  <done>
`src/lib/paths.ts` exists with exported functions for cross-platform path resolution. All paths use Node.js built-in modules.
  </done>
</task>

<task type="auto">
  <name>Create GSD and OpenCode detection</name>
  <files>src/lib/detector.ts</files>
  <action>
Create `src/lib/detector.ts` with directory detection and validation using Node.js `fs` module.

Implement:
- `detectGsd(): { found: boolean; path?: string; error?: string }`
  - Uses `getGsdPath()` from `src/lib/paths.ts`
  - Checks if directory exists using `fs.existsSync()`
  - Validates `skills/` subdirectory exists (where `/gsd:*` commands live)
  - Returns `{ found: true, path: '/absolute/path' }` on success
  - Returns `{ found: false, error: 'GSD not found at ~/.claude/get-shit-done/' }` on failure

- `detectOpenCode(): { found: boolean; path?: string; created?: boolean; error?: string }`
  - Uses `getOpenCodePath()` from `src/lib/paths.ts`
  - Checks each candidate path in priority order
  - If none exist, creates `~/.config/opencode/` using `fs.mkdirSync({ recursive: true })`
  - Returns `{ found: true, path: '/absolute/path', created: false }` if found existing
  - Returns `{ found: true, path: '/absolute/path', created: true }` if created new
  - Returns `{ found: false, error: 'Cannot create OpenCode directory' }` on failure

Use only Node.js built-in modules: `fs`, `path`. No try/catch needed - let errors propagate for now.
  </action>
  <verify>
Build succeeds: `npm run build`
Imports from `src/lib/paths.ts` are valid
Functions return typed objects with expected fields
  </verify>
  <done>
`src/lib/detector.ts` exists with `detectGsd()` and `detectOpenCode()` functions that validate installation paths using filesystem checks.
  </done>
</task>

<task type="auto">
  <name>Add unit tests for detection</name>
  <files>src/lib/detector.test.ts</files>
  <action>
Create `src/lib/detector.test.ts` using Vitest to verify detection logic.

Test cases:
- `paths.resolveHome()` expands ~ correctly on current platform
- `paths.getGsdPath()` returns expected path with platform-specific separators
- `paths.getOpenCodePath()` returns first existing directory from candidates
- `detector.detectGsd()` returns `found: false` for non-existent path (without actual GSD installed)
- `detector.detectOpenCode()` handles missing directories gracefully

Use Vitest's `describe`, `it`, `expect` syntax. Mock filesystem checks if needed using Vitest's mocking capabilities, but prefer testing actual behavior where possible.

Keep tests simple - focus on path resolution correctness and error handling, not exhaustive coverage.
  </action>
  <verify>
Tests pass: `npm test`
All exported functions from paths.ts and detector.ts are tested
  </verify>
  <done>
Detection logic has unit test coverage verifying cross-platform path resolution and validation behavior.
  </done>
</task>

</tasks>

<verification>
Run `npm run build` - build succeeds with no errors
Run `npm test` - all tests pass
Check exports: `src/lib/paths.ts` exports path functions, `src/lib/detector.ts` exports detect functions
Verify no external dependencies added to package.json (only Node.js built-ins used)
</verification>

<success_criteria>
Detection infrastructure is complete when:
- [ ] Path resolution works on all platforms (Windows, macOS, Linux)
- [ ] GSD detection validates `~/.claude/get-shit-done/skills/` exists
- [ ] OpenCode detection checks multiple candidate paths in priority order
- [ ] OpenCode detection creates directory if none exist
- [ ] All functions use Node.js built-in modules only
- [ ] Unit tests verify cross-platform behavior
- [ ] Build and test commands succeed
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-installer/01-01-SUMMARY.md`
</output>
