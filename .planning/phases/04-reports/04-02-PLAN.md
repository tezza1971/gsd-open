---
phase: 04-reports
plan: 02
type: execute
wave: 2
depends_on: [04-01]
files_modified:
  - src/lib/transpilation/reporter.ts
autonomous: true

must_haves:
  truths:
    - "User sees console report showing which GSD commands were/weren't portable"
    - "User sees shortfall analysis with specific feature gaps listed"
    - "Shortfalls are categorized by cause with color coding"
    - "User sees source→target mappings for all artifacts"
  artifacts:
    - path: "src/lib/transpilation/reporter.ts"
      provides: "Console report formatter with sections, shortfalls, summary"
      exports: ["generateReport", "FormattedReport", "ReportSummary"]
      min_lines: 200
  key_links:
    - from: "src/lib/transpilation/reporter.ts"
      to: "TransformGaps type"
      via: "consumes gaps with sourceFile, category, suggestion"
      pattern: "gap\\.sourceFile.*gap\\.category.*gap\\.suggestion"
    - from: "src/lib/transpilation/reporter.ts"
      to: "picocolors"
      via: "formats console output with colors"
      pattern: "pc\\.(red|green|yellow|blue|bold|dim)"
---

<objective>
Build console reporter that formats transpilation results into human-readable output with artifact status, shortfalls, and summary.

Purpose: Enable users to understand at a glance what transpiled successfully, what fell short, and what they can do about gaps.

Output: reporter.ts module that consumes TranspileResult and returns formatted console output with sections, colors, and categorized shortfalls.
</objective>

<execution_context>
@C:\Users\Terence\code\gsd-for-hobos\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\Terence\code\gsd-for-hobos\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\Terence\code\gsd-for-hobos\.planning\PROJECT.md
@C:\Users\Terence\code\gsd-for-hobos\.planning\ROADMAP.md
@C:\Users\Terence\code\gsd-for-hobos\.planning\STATE.md
@C:\Users\Terence\code\gsd-for-hobos\.planning\phases\04-reports\04-CONTEXT.md
@C:\Users\Terence\code\gsd-for-hobos\.planning\phases\04-reports\04-RESEARCH.md

# Prior phase summaries
@C:\Users\Terence\code\gsd-for-hobos\.planning\phases\03-transpilation\03-03-SUMMARY.md

# Reference patterns
@C:\Users\Terence\code\gsd-for-hobos\src\lib\detection\reporter.ts

# Source files
@C:\Users\Terence\code\gsd-for-hobos\src\types\index.ts
@C:\Users\Terence\code\gsd-for-hobos\src\lib\transpilation\orchestrator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reporter module with types and core structure</name>
  <files>src/lib/transpilation/reporter.ts</files>
  <action>
Create src/lib/transpilation/reporter.ts with:

1. **Imports:**
   - picocolors as pc
   - TranspileResult, TransformGaps, OpenCodeConfig from types
   - Follow ESM .js extensions pattern from existing modules

2. **Types:**
   ```typescript
   export interface ReportOptions {
     dryRun?: boolean;
     quietMode?: boolean;
   }

   export interface FormattedReport {
     console: string;        // Formatted console output
     markdown: string;       // Markdown version (Phase 4 Plan 2)
     summary: ReportSummary;
   }

   export interface ReportSummary {
     totalArtifacts: number;
     successful: number;
     partial: number;
     failed: number;
     shortfallCount: number;
     shortfallsByCategory: {
       unsupported: number;
       platform: number;
       missingDep: number;
     };
   }
   ```

3. **Main function signature:**
   ```typescript
   export function generateReport(
     result: TranspileResult,
     options?: ReportOptions
   ): FormattedReport
   ```

4. **Structure (stub implementations for now):**
   - `formatArtifactSections()` - Commands, agents, models sections
   - `formatShortfallSection()` - Categorized gaps with colors
   - `formatSummarySection()` - Totals and percentages
   - `generateReport()` - Orchestrates all sections

Follow patterns from src/lib/detection/reporter.ts for section structure and picocolors usage (bold headers, green ✓, yellow ⚠, red ✗, dim for details).

Leave markdown field empty for now (Plan 3 will implement).
  </action>
  <verify>
Run: npm run build

Check reporter.ts compiles. Check exports are available. Manually inspect file structure matches task description.
  </verify>
  <done>
reporter.ts exists with types and function stubs. TypeScript compilation succeeds. Module exports generateReport, FormattedReport, ReportSummary.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement artifact sections formatting</name>
  <files>src/lib/transpilation/reporter.ts</files>
  <action>
Implement formatArtifactSections() to display commands, agents, models:

**Format per section:**
```
[bold]Commands (3 items)[/bold]

  [green]✓[/green] /gsd:plan-phase
    Status: Success
    Source: ~/.claude/get-shit-done/commands/plan-phase.md
    Target: .opencode/commands.json

  [yellow]⚠[/yellow] /gsd:execute-phase
    Status: Partial (2 features approximated)
    Source: ~/.claude/get-shit-done/commands/execute-phase.md
    Target: .opencode/commands.json
    Approximated: variables → template literals, conditionalExecution → agent routing

  [red]✗[/red] /gsd:cleanup
    Status: Failed
    Source: ~/.claude/get-shit-done/commands/cleanup.md
    Reason: Missing required agent reference

[bold]Agents (2 items)[/bold]
  ... (same pattern)
```

**Logic:**
1. Parse TranspileResult to extract artifact list (infer from OpenCodeConfig if present, or from manifest mappings)
2. For each artifact:
   - Determine status: Success (no gaps), Partial (approximations), Failed (errors), Warning (warnings)
   - Match gaps to artifact using sourceFile field
   - Format with appropriate symbol and color
   - Show source path (full), target path (relative), and status details
3. Use picocolors: bold for headers, green ✓ success, yellow ⚠ partial/warning, red ✗ failed
4. Group artifacts by type (commands, agents, models)
5. Add blank lines between sections for readability

Handle edge cases: no artifacts, all success (brief "All commands transpiled successfully!"), all failed.

**Don't implement timing yet** - that requires orchestrator changes (out of scope). Add TODO comment for future timing integration.
  </action>
  <verify>
Run: npm run build

Check formatArtifactSections() function exists and compiles. Manually test with mock TranspileResult in Node REPL to verify output format matches specification.
  </verify>
  <done>
formatArtifactSections() formats commands, agents, models with status symbols, source/target paths, and gap details. Function compiles and produces expected console output.
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement shortfall section and summary</name>
  <files>src/lib/transpilation/reporter.ts</files>
  <action>
Implement formatShortfallSection() and formatSummarySection():

**Shortfall section format:**
```
[bold]SHORTFALLS (6 issues: 3 unsupported, 2 platform, 1 missing dependency)[/bold]

  [red]Unsupported (3)[/red]
  - conditionalExecution: Not available in OpenCode.
    Suggestion: Use agent routing or multiple commands.
    Source: ~/.claude/get-shit-done/commands/execute-phase.md
  - customRenderer: OpenCode doesn't support custom renderers.
    Suggestion: Use built-in OpenCode renderers.
    Source: ~/.claude/get-shit-done/agents/renderer-agent.md

  [yellow]Platform Differences (2)[/yellow]
  - variables: OpenCode uses template literals.
    Suggestion: Rewrite using {{variable}} syntax.
    Source: ~/.claude/get-shit-done/commands/plan-phase.md

  [blue]Missing Dependencies (1)[/blue]
  - pluginRequirements: Requires tool-plugin module.
    Suggestion: Install @opencode/tool-plugin.
    Source: ~/.claude/get-shit-done/agents/tool-agent.md
```

**Summary format:**
```
[bold]SUMMARY[/bold]
  Total artifacts: 5
  Successful: 2 (40%)
  Partial: 1 (20%)
  Failed: 2 (40%)
  Gaps: 6 total (3 unsupported, 2 platform, 1 missing dependency)
  Backup: ~/.opencode-backup/2026-01-22_142530/
```

**Logic:**
1. **Shortfalls:** Combine unmappedFields + approximations from TransformGaps
2. Group by category (unsupported, platform, missing-dependency)
3. Count per category for header
4. Format with colors: red unsupported, yellow platform, blue missing-dep
5. Each gap shows: field/feature, reason, suggestion, source file (full path)
6. **No deduplication** - list each gap individually per requirements

7. **Summary:** Calculate totals from artifact statuses
8. Show percentages for success/partial/failed
9. Include gap count by category
10. Show backup location if present (from result.backupLocation)

**Special case:** If 100% success and 0 gaps, format shortfall section as: "All features transpiled successfully! No shortfalls."

Implement generateReport() to orchestrate: artifact sections → blank line → shortfall section → blank line → summary.

Respect options.quietMode: if true, return minimal output (summary only).
  </action>
  <verify>
Run: npm run build && npm test -- reporter.test.ts

Create basic reporter.test.ts if needed to verify:
- All sections present in output
- Shortfall counts match gap lists
- Summary calculations correct
- Quiet mode suppresses detail sections
  </verify>
  <done>
formatShortfallSection() and formatSummarySection() format categorized gaps and summary statistics. generateReport() produces complete console output. Tests verify section structure and counts.
  </done>
</task>

</tasks>

<verification>
## Overall Phase Checks

1. reporter.ts exports generateReport(), FormattedReport, ReportSummary
2. Console output includes artifact sections, shortfall section, summary
3. Colors applied via picocolors (red, yellow, green, blue, bold, dim)
4. Shortfall counts match actual gap lists
5. Quiet mode respected (minimal output)
6. TypeScript compilation succeeds
7. Tests verify formatting logic
</verification>

<success_criteria>
## Measurable Completion

- [ ] reporter.ts module exists with all exports
- [ ] generateReport() returns FormattedReport with formatted console output
- [ ] Console output includes: Commands, Agents, Shortfalls, Summary sections
- [ ] Shortfalls categorized by unsupported (red), platform (yellow), missing-dep (blue)
- [ ] Summary shows totals, percentages, gap counts by category
- [ ] npm run build succeeds
- [ ] Reporter tests verify output structure and counts
- [ ] Example output matches format specified in CONTEXT.md
</success_criteria>

<output>
After completion, create `.planning/phases/04-reports/04-02-SUMMARY.md` documenting:
- reporter.ts structure and exports
- Console output format with examples
- Shortfall categorization logic
- Summary calculation approach
- Testing strategy
</output>
