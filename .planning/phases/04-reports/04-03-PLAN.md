---
phase: 04-reports
plan: 03
type: execute
wave: 2
depends_on: [04-01]
files_modified:
  - src/lib/transpilation/markdown-generator.ts
  - src/commands/transpile.ts
autonomous: true

must_haves:
  truths:
    - "User can save markdown version of report to local file"
    - "User is prompted interactively to save markdown after transpilation"
    - "Markdown includes more detail than console (full config snippets)"
    - "Markdown has YAML frontmatter and table of contents"
  artifacts:
    - path: "src/lib/transpilation/markdown-generator.ts"
      provides: "Markdown report generation with frontmatter, TOC, collapsed config"
      exports: ["generateMarkdown"]
      min_lines: 150
    - path: "src/commands/transpile.ts"
      provides: "Integrated reporter and markdown export prompt"
      min_lines: 180
  key_links:
    - from: "src/commands/transpile.ts"
      to: "generateReport"
      via: "calls reporter.generateReport()"
      pattern: "generateReport\\(result"
    - from: "src/commands/transpile.ts"
      to: "generateMarkdown"
      via: "calls markdown-generator.generateMarkdown()"
      pattern: "generateMarkdown\\(result"
    - from: "src/commands/transpile.ts"
      to: "@clack/prompts"
      via: "prompts user to save markdown"
      pattern: "confirm.*Save report to markdown"
---

<objective>
Add markdown export capability and integrate reporting into transpile command with interactive prompt.

Purpose: Enable users to save detailed transpilation reports to markdown for documentation, sharing, and reference.

Output: markdown-generator.ts for markdown creation, updated transpile.ts with reporter integration and save prompt.
</objective>

<execution_context>
@C:\Users\Terence\code\gsd-for-hobos\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\Terence\code\gsd-for-hobos\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\Terence\code\gsd-for-hobos\.planning\PROJECT.md
@C:\Users\Terence\code\gsd-for-hobos\.planning\ROADMAP.md
@C:\Users\Terence\code\gsd-for-hobos\.planning\STATE.md
@C:\Users\Terence\code\gsd-for-hobos\.planning\phases\04-reports\04-CONTEXT.md
@C:\Users\Terence\code\gsd-for-hobos\.planning\phases\04-reports\04-RESEARCH.md

# Prior phase summaries
@C:\Users\Terence\code\gsd-for-hobos\.planning\phases\03-transpilation\03-03-SUMMARY.md

# Source files
@C:\Users\Terence\code\gsd-for-hobos\src\commands\transpile.ts
@C:\Users\Terence\code\gsd-for-hobos\src\types\index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create markdown generator module</name>
  <files>src/lib/transpilation/markdown-generator.ts</files>
  <action>
Create src/lib/transpilation/markdown-generator.ts with markdown report generation:

**Imports:**
- TranspileResult, TransformGaps, OpenCodeConfig from types
- ESM .js extensions

**Function signature:**
```typescript
export function generateMarkdown(result: TranspileResult): string
```

**Markdown structure:**

1. **YAML frontmatter:**
```yaml
---
title: Transpilation Report
date: 2026-01-22T14:25:30Z  (ISO 8601)
tool: gsd-for-hobos
version: <from package.json if accessible, else "1.0.0">
---
```

2. **Table of contents:**
```markdown
# Transpilation Report

## Table of Contents
- [Summary](#summary)
- [Commands](#commands)
- [Agents](#agents)
- [Models](#models)
- [Shortfalls](#shortfalls)
- [Configuration](#configuration)
```

3. **Summary section:** Same data as console summary but in markdown table format

4. **Artifact sections:** Commands, agents, models with status tables showing:
   - Name
   - Status (Success/Partial/Failed/Warning)
   - Source path
   - Target path
   - Notes (gaps, approximations, errors)

5. **Shortfalls section:** Categorized list with:
   - Category headers (Unsupported, Platform Differences, Missing Dependencies)
   - Each gap: feature name, reason, suggestion, source file
   - Plain text (no color codes, use **bold** for headers)

6. **Configuration section:** Full generated configs in collapsed `<details>` blocks:
```markdown
### Generated Commands
<details>
<summary>commands.json</summary>

\`\`\`json
{...full commands.json content...}
\`\`\`
</details>
```

**Logic:**
1. Build markdown string via template literals (no markdown library needed)
2. Escape special markdown characters in user content (*, #, [, ], etc.)
3. Format JSON with 2-space indent via JSON.stringify
4. Generate TOC with anchor links (#section-name)
5. Include full OpenCodeConfig from result if available

**No console colors** - markdown is plain text with markdown formatting only.

Use plain string concatenation and template literals. No need for markdown generation library per research recommendations.
  </action>
  <verify>
Run: npm run build

Check markdown-generator.ts compiles. Manually test with mock TranspileResult to verify markdown syntax is valid (check with markdown preview or linter).
  </verify>
  <done>
markdown-generator.ts exists and exports generateMarkdown(). Function produces valid markdown with frontmatter, TOC, sections, and collapsed config snippets. Compilation succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate reporter into transpile command</name>
  <files>src/commands/transpile.ts</files>
  <action>
Update transpile.ts to use new reporter instead of inline gap reporting:

**Imports to add:**
```typescript
import { generateReport } from '../lib/transpilation/reporter.js';
import { writeFile } from 'node:fs/promises';
import { join } from 'node:path';
```

**Replace existing result reporting (lines ~101-162):**

Old inline reporting (remove):
- Manual gap reporting with pc.yellow
- Manual warning loops
- Manual success messages

New reporter integration:
```typescript
// Generate formatted report
const report = generateReport(result, {
  dryRun: options.dryRun,
  quietMode: options.quiet
});

// Display console output
if (!options.quiet) {
  console.log(report.console);
} else if (!result.success) {
  // Always show errors even in quiet mode
  console.log(report.console);
}

// Set exit code based on summary
if (report.summary.failed > 0) {
  process.exitCode = ExitCode.ERROR;
} else if (report.summary.partial > 0 || result.warnings.length > 0) {
  process.exitCode = ExitCode.WARNING;
} else {
  process.exitCode = ExitCode.SUCCESS;
}
```

**Preserve:**
- Dry-run message behavior
- Backup location announcement (include in reporter, not here)
- Manifest path announcement (include in reporter, not here)
- Error handling and rollback messages

**Don't add markdown prompt yet** - that's Task 3.

Test that transpile command still works end-to-end with reporter integration. Verify output format matches new reporter output.
  </action>
  <verify>
Run: npm run build && npm test -- transpile.test.ts

Check transpile.ts compiles. If transpile.test.ts exists, verify tests still pass. Manually test: npx tsx src/cli.ts transpile --dry-run
  </verify>
  <done>
transpile.ts uses generateReport() for result output. Console shows formatted report with sections. Exit codes set based on report summary. Build succeeds. Manual test shows expected output.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add markdown export prompt to transpile command</name>
  <files>src/commands/transpile.ts</files>
  <action>
Add interactive markdown save prompt after successful transpilation:

**Import:**
```typescript
import { generateMarkdown } from '../lib/transpilation/markdown-generator.js';
```

**Add after report display (new code block):**
```typescript
// Offer markdown export (only on success, not in quiet/dry-run)
if (result.success && !options.quiet && !options.dryRun) {
  const saveMarkdown = await confirm({
    message: 'Save report to markdown?',
    initialValue: true,
  });

  if (isCancel(saveMarkdown)) {
    log.info('Markdown export cancelled.');
  } else if (saveMarkdown) {
    try {
      const markdown = generateMarkdown(result);
      const filePath = join(process.cwd(), 'transpilation-report.md');
      await writeFile(filePath, markdown, 'utf-8');
      log.success(`Report saved to ${filePath}`);
    } catch (error) {
      log.error(`Failed to save report: ${error instanceof Error ? error.message : String(error)}`);
    }
  }
}
```

**Conditions for prompt:**
- Only on success (result.success === true)
- Not in quiet mode (options.quiet === false)
- Not in dry-run mode (options.dryRun === false)

**File location:** Save to `process.cwd()` (current working directory) per research recommendations.

**Filename:** `transpilation-report.md` (hardcoded per CONTEXT.md).

**Error handling:** Catch write errors, log with log.error(), don't fail entire command (report already displayed to console).

**Confirmation feedback:** Always log success or cancellation message so user knows outcome.

Follow existing @clack/prompts patterns from detect.ts (isCancel handling, initialValue).
  </action>
  <verify>
Run: npm run build

Manual test flow:
1. Run: npx tsx src/cli.ts transpile --dry-run (no prompt)
2. Run: npx tsx src/cli.ts transpile --quiet (no prompt)
3. Run successful transpile without flags (should prompt)
4. Answer yes → verify transpilation-report.md created in cwd
5. Answer no → verify no file created
6. Answer Ctrl+C → verify cancellation message
  </verify>
  <done>
transpile.ts prompts user to save markdown report after successful transpilation. Markdown file written to process.cwd()/transpilation-report.md on confirmation. Proper error handling and user feedback. Manual tests verify prompt behavior.
  </done>
</task>

</tasks>

<verification>
## Overall Phase Checks

1. markdown-generator.ts exports generateMarkdown() function
2. Generated markdown includes frontmatter, TOC, sections, config snippets
3. transpile.ts uses generateReport() for console output
4. transpile.ts prompts for markdown save after success
5. Markdown file written to current working directory
6. Proper error handling for file write failures
7. TypeScript compilation succeeds
8. Manual tests verify end-to-end flow
</verification>

<success_criteria>
## Measurable Completion

- [ ] markdown-generator.ts exists and exports generateMarkdown()
- [ ] Generated markdown has YAML frontmatter with date, tool, version
- [ ] Markdown includes table of contents with anchor links
- [ ] Config snippets collapsed in `<details>` blocks
- [ ] transpile.ts uses reporter for console output (not inline reporting)
- [ ] User prompted to save markdown after successful transpilation
- [ ] Markdown saved to `process.cwd()/transpilation-report.md`
- [ ] npm run build succeeds
- [ ] Manual test: transpile → prompt appears → yes → file created
- [ ] Manual test: transpile --dry-run → no prompt
- [ ] Manual test: transpile --quiet → no prompt
</success_criteria>

<output>
After completion, create `.planning/phases/04-reports/04-03-SUMMARY.md` documenting:
- markdown-generator.ts structure and markdown format
- transpile.ts integration changes
- Markdown export prompt flow
- File location and naming
- Testing approach and results
</output>
